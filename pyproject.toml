[tool.ruff]
target-version = "py311"
line-length = 120

[tool.ruff.lint]
select = [
    "B",        # flake8-bugbear
    "C",        # complexity
    "D",        # pydocstyle
    "E",        # pycodestyle errors
    "F",        # pyflakes
    "G",        # flake8-logging-format
    "I",        # isort
    "N804",     # invalid-first-argument-name-for-class-method
    "N805",     # invalid-first-argument-name-for-method
    "N815",     # mixed-case-variable-in-class-scope
    "PGH004",   # Use specific rule codes when using noqa
    "PLC",      # pylint - convention
    "PLE",      # pylint - error
    "PLR",      # pylint - refactor
    "PLW",      # pylint - warning
    "Q000",     # bad-quotes-inline-string
    "RUF006",   # Store a reference to the return value of asyncio.create_task
    "S102",     # Use of exec detected
    "S103",     # bad-file-permissions
    "S108",     # hardcoded-temp-file
    "S306",     # suspicious-mktemp-usage
    "S307",     # suspicious-eval-usage
    "S313",     # suspicious-xmlc-element-tree-usage
    "S314",     # suspicious-xml-element-tree-usage
    "S315",     # suspicious-xml-expat-reader-usage
    "S316",     # suspicious-xml-expat-builder-usage
    "S317",     # suspicious-xml-sax-usage
    "S318",     # suspicious-xml-mini-dom-usage
    "S319",     # suspicious-xml-pull-dom-usage
    "S320",     # suspicious-xmle-tree-usage
    "S321",     # suspicious-ftp-lib-usage
    "S323",     # suspicious-unverified-context-usage
    "SIM105",   # suppressible-exception
    "SIM117",   # multiple-with-statements
    "SIM118",   # in-dict-keys
    "SIM201",   # negate-equal-op
    "SIM208",   # double-negation
    "SIM212",   # if-expr-with-twisted-arms
    "SIM300",   # yoda-conditions
    "SIM401",   # if-else-block-instead-of-dict-get
    "T20",      # flake8-print
    "TID251",   # banned-module-level-imports
    "TRY004",   # type-check-without-type-error
    "TRY203",   # useless-try-except
    "UP",       # pyupgrade
    "W",        # pycodestyle - warning
]
ignore = [
    "D202",     # No blank lines allowed after function docstring
    "D203",     # 1 blank line required before class docstring
    "D213",     # Multi-line docstring summary should start at the second line
    "D406",     # Section name should end with a newline
    "D407",     # Section name underlining
    "E501",     # line too long
    "E731",     # do not assign a lambda expression, use a def
    "PLC0208",  # Use a sequence type instead of a set when iterating over values
    "PLR0911",  # Too many return statements
    "PLR0912",  # Too many branches
    "PLR0913",  # Too many arguments to function call
    "PLR0914",  # Too many local variables
    "PLR0915",  # Too many statements
    "PLR2004",  # Magic value used in comparison
    "PLW2901",  # Outer loop variable overwritten
    "UP006",    # keep type annotation style as is
    "UP007",    # keep type annotation style as is
    "UP038",    # Use `X | Y` for type annotations
    # Conflicts with formatter
    "W191",     # Indentation contains tabs
    "E111",     # Indentation is not a multiple of four
    "E114",     # Indentation is not a multiple of four (comment)
    "E117",     # Over-indented
    "D206",     # Docstring should be indented with spaces, not tabs
    "D300",     # Use triple double quotes
    "Q000",     # Remove bad quotes
    "Q001",     # Remove bad quotes
    "Q002",     # Remove bad quotes
    "Q003",     # Remove bad quotes
    "COM812",   # Missing trailing comma
    "COM819",   # Trailing comma
    "ISC001",   # Implicit string concatenation
    "ISC002",   # Implicit string concatenation
    # Django specific - these can cause false positives
    "D100",     # Missing docstring in public module
    "D101",     # Missing docstring in public class
    "D102",     # Missing docstring in public method
    "D103",     # Missing docstring in public function
    "D104",     # Missing docstring in public package
    "D105",     # Missing docstring in magic method
    "D106",     # Missing docstring in public nested class
    "D107",     # Missing docstring in __init__
    "N999",     # Invalid module name (Django apps often have short names)
    "T100",     # Trace found (Django uses print in management commands)
]

[tool.ruff.lint.isort]
force-sort-within-sections = true
section-order = [
    "future",
    "standard-library",
    "django",
    "third-party",
    "first-party",
    "local-folder",
]
extra-standard-library = ["typing_extensions"]
known-first-party = ["phorum", "score"]
known-third-party = ["django", "rest_framework"]

[tool.ruff.lint.isort.sections]
django = ["django"]

[tool.ruff.lint.mccabe]
max-complexity = 25

[tool.ruff.lint.per-file-ignores]
# Django settings files often have complex imports and assignments
"src/score/settings/*.py" = ["F401", "F403", "F405", "E402"]
# Django migrations are auto-generated
"*/migrations/*.py" = ["E501", "D100", "D101", "D102", "D103", "D104"]
# Tests can have more assertions, magic values, and missing docstrings
"*/tests/*.py" = ["PLR2004", "S101", "D100", "D101", "D102", "D103", "D104"]
"*/tests.py" = ["PLR2004", "S101", "D100", "D101", "D102", "D103", "D104"]
# Django management commands can use print
"*/management/commands/*.py" = ["T201"]

[tool.ruff.lint.pydocstyle]
convention = "numpy"

[tool.ruff.format]
quote-style = "double"
indent-style = "space"
skip-magic-trailing-comma = false
line-ending = "auto"